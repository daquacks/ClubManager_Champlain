<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Club Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
        header { background-color: #333; color: #fff; padding: 1rem; text-align: center; }
        /*nav { display: flex; justify-content: center; background-color: #444; padding: 0.5rem; }*/
        /*!*nav a { color: #fff; text-decoration: none; margin: 0 1rem; }*!*/
        /*nav a:hover { text-decoration: underline; }*/
        .container { max-width: 75vw; margin: 2rem auto; padding: 1rem; background: #d4e0f1; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);  }
        h1 { margin: 0 auto; }

        #club-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 10px; /* Add padding to avoid clipping shadows */
            align-items: start; /* Allow cards to have different heights */
        }

        .club-card {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            background: #c1d2d2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease; /* Smooth transition for all properties */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px; /* Ensure a minimum height */
            position: relative;
            z-index: 1;
            cursor: pointer; /* Indicate it's clickable */
        }

        .club-card:hover {
            transform: translateY(-5px) scale(1.05); /* Scale slightly in both directions */
            z-index: 10; /* Bring to front */
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            background-color: #dbecec; /* Slightly lighter on hover */
        }

        .club-card h3 { 
            margin-top: 0; 
            color: #333;
            font-size: 1.2rem;
        }

        .club-card p {
            color: #666;
            flex-grow: 1;
            max-height: 60px; /* Limit height to approx 3 lines */
            overflow: hidden;
            transition: max-height 0.5s ease; /* Animate the expansion */
            position: relative;
        }

        /* Fade out effect for truncated text */
        .club-card p::after {
            content: "";
            position: absolute;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 30px;
            background: linear-gradient(to bottom, transparent, #c1d2d2);
            transition: opacity 0.3s;
        }
        
        /* Adjust fade color on hover since background changes */
        .club-card:hover p::after {
            background: linear-gradient(to bottom, transparent, #dbecec);
        }

        /* Expanded state */
        .club-card.expanded p {
            max-height: 500px; /* Allow it to grow significantly */
        }

        .club-card.expanded p::after {
            opacity: 0;
            pointer-events: none;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            text-align: center;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        .pdf-btn {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .pdf-btn:hover {
            background-color: #218838;
        }

        .search-container {
            text-align: center;
            margin: 20px 0;
        }

        #search-input {
            width: 60%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        #search-input:focus {
            border-color: #007bff;
        }
    </style>
</head>
<body>

<header>
    <h1>Club Manager</h1>
</header>


<div th:replace="~{fragments :: navbar}"></div>

<div class="container">
    <h2 style="text-align: center;">Welcome to the School Club Manager</h2>
    <p style="text-align: center;">Find clubs, join events, and connect with other students!</p>

    <a href="/api/clubs/pdf" class="pdf-btn">Download Clubs PDF</a>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search for clubs...">
    </div>

    <h3 style="text-align: center">Clubs</h3>
    <div id="club-list">
        <!-- Clubs will be loaded here via JavaScript -->
        <p>Loading clubs...</p>
    </div>
</div>

<script>
    let allClubs = []; // Store all clubs here

    // Fetch clubs from the API and display them
    fetch('/api/clubs')
        .then(response => response.json())
        .then(clubs => {
            allClubs = clubs; // Save the fetched clubs
            displayClubs(allClubs); // Display all clubs initially
        })
        .catch(error => {
            console.error('Error fetching clubs:', error);
            document.getElementById('club-list').innerHTML = '<p>Error loading clubs.</p>';
        });

    // Function to display clubs
    function displayClubs(clubs) {
        const clubList = document.getElementById('club-list');
        clubList.innerHTML = ''; // Clear current list

        if (clubs.length === 0) {
            clubList.innerHTML = '<p>No clubs found.</p>';
            return;
        }

        clubs.forEach(club => {
            const card = document.createElement('div');
            card.className = 'club-card';
            
            // Add click event to toggle expansion
            card.onclick = function(e) {
                // If the user clicked the "View Details" button, don't toggle expansion
                if (e.target.closest('.btn')) return;
                
                this.classList.toggle('expanded');
            };

            card.innerHTML = `
                <h3 style="text-align: center;">${club.name || "No name available" }</h3>
                <p style="text-align: center;">${club.overview || club.description || "No overview available"}</p>
                <a href="/clubs/${club.id}" class="btn">View Details</a>
            `;
            clubList.appendChild(card);
        });
    }

    // Search functionality
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        
        const filteredClubs = allClubs.filter(club => {
            const name = (club.name || '').toLowerCase();
            const description = (club.description || '').toLowerCase();
            const overview = (club.overview || '').toLowerCase();
            
            return name.includes(searchTerm) || 
                   description.includes(searchTerm) || 
                   overview.includes(searchTerm);
        });

        displayClubs(filteredClubs);
    });
</script>

</body>
</html>
