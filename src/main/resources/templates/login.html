<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Login - Club Manager</title>
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Add the Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f2f5;
        }
        .login-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 { margin-bottom: 1.5rem; color: #333; }
        .error-message { color: red; margin-top: 1rem; display: none; }
    </style>
</head>
<body>
    <div class="login-container">
        <h1>Club Manager Login</h1>
        <div id="firebaseui-auth-container"></div>
        <div id="error-message" class="error-message"></div>
    </div>

    <script th:inline="javascript">
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBRR1N7QwS5cvkUWGBbkXb0MbIaD7yC4zs",
            authDomain: "clubmanager-6fb48.firebaseapp.com",
            projectId: "clubmanager-6fb48",
            storageBucket: "clubmanager-6fb48.firebasestorage.app",
            messagingSenderId: "121218077729",
            appId: "1:121218077729:web:39e5e422dc10f9e6f5ff60",
            measurementId: "G-6J17L4M3BV"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize the FirebaseUI Widget using Firebase.
        var ui = new firebaseui.auth.AuthUI(firebase.auth());

        var uiConfig = {
            callbacks: {
                signInSuccessWithAuthResult: function(authResult, redirectUrl) {
                    // User successfully signed in.
                    // Return type determines whether we continue the redirect automatically
                    // or whether we leave that to developer to handle.
                    
                    // Here you would typically send the ID token to your backend
                    authResult.user.getIdToken().then(function(idToken) {
                        // Send token to your backend via fetch/XHR
                        fetch('/api/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ token: idToken })
                        }).then(response => {
                            if (response.ok) {
                                window.location.assign('/');
                            } else {
                                response.text().then(text => {
                                    const errorDiv = document.getElementById('error-message');
                                    errorDiv.textContent = "Login failed: " + text;
                                    errorDiv.style.display = 'block';
                                });
                            }
                        }).catch(error => {
                            const errorDiv = document.getElementById('error-message');
                            errorDiv.textContent = "Network error: " + error.message;
                            errorDiv.style.display = 'block';
                        });
                    });
                    return false;
                },
                uiShown: function() {
                    // The widget is rendered.
                    // Hide the loader.
                    // document.getElementById('loader').style.display = 'none';
                }
            },
            // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
            signInFlow: 'popup',
            signInSuccessUrl: '/',
            signInOptions: [
                // Leave the lines as is for the providers you want to offer your users.
                firebase.auth.EmailAuthProvider.PROVIDER_ID,
                firebase.auth.GoogleAuthProvider.PROVIDER_ID
            ],
            // Terms of service url.
            tosUrl: '<your-tos-url>',
            // Privacy policy url.
            privacyPolicyUrl: '<your-privacy-policy-url>'
        };

        // The start method will wait until the DOM is loaded.
        ui.start('#firebaseui-auth-container', uiConfig);
    </script>
</body>
</html>
